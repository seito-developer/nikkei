# Firebase Hosting
こちらはFirebaseでWebアプリケーションを作っている場合におすすめの方法です。  
Chapter 7.xまででCloud Firestore作成したWebアプリケーションはこのままFirebase Hostingでホスティングしましょう。

公式サイトにドキュメントがあるので、これに倣って解説していきます。
https://firebase.google.com/docs/hosting/quickstart?hl=ja

## Firebase Hostingの初期化・必要な設定ファイルを作成する
まずFirebase Hostingを利用するにはFirebase CLIがご自身のPCにインストールされている必要があります。（Chapter 7.7参照）
その上で、Firebase CLIを使ってまずコマンドラインからFirebaseにログインします。  
コマンドラインを開き、`firebase login`と入力、エンターキーを押してください。

「Allow Firebase to collect CLI and Emulator Suite usage and error reporting information?(FirebaseがCLIやEmulator Suiteの使用状況やエラー報告情報を収集できるようにしますか？)」というメッセージが表示されるので、yかn(YES or NO)を押してエンターキーを押します。  
するとブラウザが立ち上がり、GoogleアカウントでFirebaseにログインするよう求められますので、すでに登録済みのアカウントでログインします。

![Alt text](<../Chapter 8.ホスティング/images/firebase/hosting-1.png>)

ログインしようとすると初回は「Firebase CLI が Google アカウントへのアクセスをリクエストしています」と表示されることがありますが、「許可」をクリックします。

![Alt text](<../Chapter 8.ホスティング/images/firebase/hosting-2.png>)

ログインが成功すると、ブラウザには「Woohoo! Firebase CLI Login Successful」と表示され、コマンドライン上にも「Success! Logged in as アカウントのメールアドレス」と表示されます。ここでこのブラウザ画面は閉じてしまってOKです。    

![Alt text](<../Chapter 8.ホスティング/images/firebase/hosting-3.png>)

コマンドラインに戻り、`firebase init hosting`と入力し、エンターキーを押します。
するとアスキーアートで派手に「FIREBASE」と表示された後、いくつか問答をすることになりますので、下記のように答えてください。(矢印キー上下で選択、エンターキーで決定)

![Alt text](<../Chapter 8.ホスティング/images/firebase/hosting-4.png>)

### 1. Please select an option (オプションを選択してください)
-> Use an existing project (既存のプロジェクトを使用する)

Chapter 7でこれまですでに日報報告アプリを作っているので、こちらを選択します。

### 2. Select a default Firebase project for this directory (このディレクトリのデフォルトのFirebaseプロジェクトを選択してください)
-> daily-report-xxx (daily-report)

Firebaseにログインが成功していれば、アカウントに紐づいた制作済みのアプリケーション一覧が選択肢に上がるはずです。  
すでに`daily-report`という名前で日報報告アプリケーションを作っているので、これを選択します。(xxxには固有の番号が振られています)

### 3. What do you want to use as your public directory? (パブリックディレクトリとして何を使用しますか？)
-> `dist`

ホスティング時に対象とするディレクトリ名を入力します。後述しますが、こでは`dist`と入力しておいてください。

### 4. Configure as a single-page app (rewrite all urls to /index.html)? (シングルページアプリとして構成しますか（すべてのurlを/index.htmlに書き換えます）？)
-> n
SPA(シングルページアプリ)とは、簡単に言えば従来のWebアプリケーションのようなページ遷移を行わず、あたかも1つのページで完結しているような構成のアプリケーションのことです。  
今回作っているアプリケーションはSPAではないのでn(No)とします。

### 5. Set up automatic builds and deploys with GitHub? (GitHubで自動ビルドとデプロイを設定しますか？)
-> n
y(Yes)にすると、GitHubの「GitHub Action」というサービスを使い、アプリケーションを保管しているGitHubリポジトリが更新されると自動でビルド（データが更新されてホスティングされる）されるようになります。  
このような自動化を行うと継続的にアプリケーション開発を更新するプロセスを効率化できるため、実際の開発現場でも近年よく取り入れられています。
今回は説明を簡略化するために割愛するので、nを選びます。

ここまでを完了すると、Firebase Hostingを利用する上で必要なファイル`firebase.json`,`.firebaserc`が生成され、コマンドライン上に「Firebase initialization complete!」の文字が表示されます。

![Alt text](<../Chapter 8.ホスティング/images/firebase/hosting-complete.png>)

また同時に`dist`フォルダが作成され、index.htmlと404.htmlというおまけのファイルが作成されるかと思います。  
`dist`フォルダが空のままホスティングを実行するとこれらのファイルがデフォルトで設定されます。

## ビルド, デプロイ, ホスティングを実行
さて、ここまででFirebase Hostingの準備が整いました。このあと、ビルド, デプロイ, ホスティングの3つのステップを踏んでWebアプリケーションが利用可能となります。
Chapter 2.7で少しだけ触れましたが、これらの用語はそれぞれ下記のような意味があります。

- ビルド: デプロイに必要な実行ファイルを作ること
- デプロイ: 実行ファイルを実際のWebサーバー上に配置して、利用できる状態にすること
- ホスティング: サーバーを借りること

これらのプロセスはそれぞれ下記のツールまたはサービスが対応しています。

- ビルド -> Vite
- デプロイ -> Firebase CLI
- ホスティング -> Firebase Hosting

というわけで、少々ややこしいですが、この順番に沿ってホスティングまで進めていきましょう！

### Viteでのビルド
Viteでビルドする際、HTMLが複数ページある場合には事前に設定を加える必要があります。（1ページのみの場合は不要）  
プロジェクトのルートディレクトリ（`firebase.json`や`package.json`らと同じ階層）に、`vite.config.js`を作り、下記を記述します。

```js
1 import { resolve } from 'path'
2 import { defineConfig } from 'vite'

3 export default defineConfig({
4   build: {
5     rollupOptions: {
6       input: {
7         main: resolve(__dirname, 'index.html'),
8         history: resolve(__dirname, 'history.html'),
9       },
10     },
11   },
12 })
```

8行目に`history.html`を読み込む記述があることに注目してください。  
もしページが増える場合には、都度ここに`ページ名: resolve(__dirname, 'ページまでのパス')`を追記します。

なお、この情報は公式サイトにも記載がありますので、もし本書以上にアレンジを加えたい場合は参考にしてください。
https://ja.vitejs.dev/guide/build.html
https://ja.vitejs.dev/guide/static-deploy.html

その後、コマンドラインで`npm run build`と入力します。（一応念を押させていただきますが、`npm run dev`などと同じ`package.json`があるディレクトリで実行する必要があります。これまで同様、Cursorでプロジェクトを開いた状態でコマンドラインを使う場合には迷わないはずです）  

`package.json`を開くと`"build": "vite build",`という記述がありますが、このコマンドが実行されるわけです。  
ビルドが成功すると、`dist`ディレクトリにhtmlやjsなどの各種ファイルが出力されます。

![Alt text](<../Chapter 8.ホスティング/images/firebase/npm-run-build.png>)

### Firebase CLIでのデプロイ
ビルド後、Firebase CLIでのデプロイを行います。このプロセスはとてもシンプルで、コマンドラインで`firebase deploy`と入力するだけです。
成功したらコマンドラインに「Deploy complete!」のテキストと主に、「Project Console: コンソール画面へのURL」「Hosting URL: ホスティングされたアプリケーションのURL」が表示されます。  
このURLはカーソルを乗せた状態でcmd(macOSの場合。windowsの場合はctrl）を押しながらクリックすると、ブラウザでそのまま開くことが出来ます。  

![Alt text](<../Chapter 8.ホスティング/images/firebase/firebase-deploy.png>)

![Alt text](<../Chapter 8.ホスティング/images/firebase/hosting-url.png>)

また、ホスティングされたあとはFirebaseのダッシュボードで、左メニュー「構築」　→　Hostingで情報を見ることが出来ます。  
例えば「ドメイン」セクションにはホスティングされたURLの記載があるので、忘れてしまった場合にはここを確認してください。
![Alt text](<../Chapter 8.ホスティング/images/firebase/hosting-dashboard.png>)