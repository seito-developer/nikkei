# Cloud FirestoreによるDB構築
さて、Firebaseのセットアップが済んだので、いよいよこのセクションではCloud FirestoreでDBを構築し、アプリケーションと連携させてみましょう。

## Cloud Firestoreのデータ構造
NoSQLであるCloud Firestoreのデータ構造は「コレクション、ドキュメント、データ」のシンプルな3階層から構成されます。
コレクションは複数のドキュメントをまとめる単位で、ドキュメントは複数のデータをまとめることができる単位です。最小単位であるデータは文字列や数字などの要素を指します。

今回の日報アプリの例では、1つ1つの日報の記録＝ドキュメントとなり、データ＝日報の詳細（日時、コメント内容など）となります。
シンプルなアプリケーションなので、コレクションはこれらドキュメントをもつコレクション1つだけが存在する形になります。
（もしこのアプリケーションがもっと複雑で、例えば複数のユーザーや組織に使われることを想定した場合は、それらをまとめるために複数のコレクションが存在することになるでしょう）

<!-- イメージ図 -->

## Cloud Firestoreでダミーデータを作成する
先の説明でデータ構造の概念自体はなんとなくお伝えできたかと思います。
それを踏まえて、実際にデータがどのように管理されるのか、Cloud Firestoreのダッシュボード上でダミーのデータを作成することで確かめてみましょう。

Cloud Firestoreのコンソール画面で「コレクションを開始」をクリックします。
![Alt text](<../Chapter 7.実演・サーバーサイド・プログラム/images/firebase/database/firebase-5.png>)

「コレクション ID」に`reports`と入力し、「次へ」ボタンをクリックします。

![Alt text](<../Chapter 7.実演・サーバーサイド・プログラム/images/firebase/database/firebase-6.png>)

「ドキュメント ID」に、「自動ID」をクリックしてランダムな値を入力します。
![Alt text](<../Chapter 7.実演・サーバーサイド・プログラム/images/firebase/database/firebase-7.png>)

フィールドにはまず「フィールドを追加」を押して合計4つの入力欄を用意してください。
その上で下記を設定します。

- フィールド：date, タイプ：timestamp、値：2024年1月1日 19:00:00
- フィールド：name, タイプ：string、値：山田太郎
- フィールド：work, タイプ：string、値：コーディング
- フィールド：comment, タイプ：string、値：ログイン機能の作成

これはつまり、山田太郎さんという社員がコーディングの業務（ログイン機能の作成）を2024年1月1日に行ったことを意味する日報のダミー記録です。

入力が完了したら「保存」ボタンをクリックします。
![Alt text](<../Chapter 7.実演・サーバーサイド・プログラム/images/firebase/database/firebase-8.png>)

するとデータベース上に入力したコレクション、ドキュメント、データが反映されます。
いかがでしょうか？先程は概念だけを一旦説明してみましたが、コレクション、ドキュメント、データが実際にはどのようにデータベース上で扱われるのか、より具体的におわかりいただけたのではないでしょうか。

これだけではまだデータベース上にデータが存在しているだけで、Webページとは繋がっていません。
そこで次はいよいよ、JSを使ってこのデータベースとWebアプリケーションを連携させ、データの送信〜保存や取得〜表示までを行って見たいと思います。

## データ送信／取得のロジック作成

まず実際にコーディングを行う前に、これからどのようなロジックをどんな手順で実装すればいいのか、一度整理してみましょう。具体的にはざっと下記のようなタスクに分解・整理できるはずです。

1. 初回（Webページがはじめにロードされたとき）Firestoreを初期化する
2. （フォームが送信されたタイミングで）Firestoreにデータを追加する
3. （フォームが送信されたタイミングで）Firestoreからデータを取得する
4. 取得したデータをテーブルのタグに合わせて表示する

これに従って順番にコーディングしていきたいと思います。
ここで私が単純に1~4を行うコードを示し

## データの取得・表示
`main.js`を開き、下記のコードを追記します。

```js
import { collection, getDocs, getFirestore } from "firebase/firestore"; 

const querySnapshot = await getDocs(collection(db, "users"));
querySnapshot.forEach((doc) => {
  console.log(`${doc.id} => ${doc.data()}`);
});
```

